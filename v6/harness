use Metamodel;
use Op;
use Body;
use Unit;
use JSYNC;
use NAMOutput;
use NieczaFrontendSTD;
use NieczaPassBegin;
use NieczaPassBeta;
use NieczaPassSimplifier;

use MONKEY_TYPING;
use NieczaActions;

my $fe = NieczaFrontendSTD.new(
    lang => 'NULL',
    safemode => False,
    unitname => 'CORE',
    loader => sub ($mn) { die "Module loading NYI" },
);

my %*units;
my $mm = $fe.parse(filename => "RUN.pl", source => slurp("RUN.pl"));
$mm = NieczaPassBegin.new.invoke($mm);
$mm = NieczaPassBeta.new.invoke($mm);
$mm = NieczaPassSimplifier.new.invoke($mm);
my $nstr = NAMOutput.run($mm);

spew "../obj/RUN.nam", $nstr;
